"""
ماژول تولید پیام‌های تبریک نوروزی
"""

def generate_greeting(llm, recipient_name, sender_name, topic=None):
    """
    تولید پیام تبریک نوروزی محاوره‌ای و رسمی
    
    پارامترها:
    llm (ChatOpenAI): مدل زبانی
    recipient_name (str): نام گیرنده
    sender_name (str): نام فرستنده
    topic (str, optional): موضوع مورد علاقه گیرنده
    
    خروجی:
    str: پیام تبریک تولید شده
    """
    if topic and topic.strip():
        prompt = f"""
        لطفا یک پیام تبریک عید نوروز کاملا محاوره‌ای (با لحن گفتاری واقعی) و در عین حال مودبانه به زبان فارسی بنویس که از طرف {sender_name} به {recipient_name} فرستاده می‌شود.
        
        خیلی مهم: پیام را با یک بیت شعر یا مصرعی از شاعران بزرگ ایرانی مانند حافظ، سعدی، مولانا یا فردوسی که مرتبط با بهار، نوروز یا سال نو باشد شروع کن.
        
        متن باید کاملاً محاوره‌ای باشد، مثل اینکه واقعاً داری با طرف مقابل صحبت می‌کنی.
        از کلمات و اصطلاحات محاوره‌ای روزمره استفاده کن، مثل "میگم"، "خیلی خوشحالم"، "امیدوارم"، "انشالله" و غیره.
        از شکل‌های کوتاه‌شده کلمات مثل "می‌خوام" به جای "می‌خواهم" استفاده کن.
        موضوع مورد علاقه گیرنده "{topic}" است که باید به آن اشاره شود.
        
        پیام باید با ایموجی‌های متنوع و شاد نوروزی همراه باشد.
        پیام باید محترمانه اما کاملاً محاوره‌ای، گرم و صمیمی باشد.
        """
    else:
        prompt = f"""
        لطفا یک پیام تبریک عید نوروز کاملا محاوره‌ای (با لحن گفتاری واقعی) و در عین حال مودبانه به زبان فارسی بنویس که از طرف {sender_name} به {recipient_name} فرستاده می‌شود.
        
        خیلی مهم: پیام را با یک بیت شعر یا مصرعی از شاعران بزرگ ایرانی مانند حافظ، سعدی، مولانا یا فردوسی که مرتبط با بهار، نوروز یا سال نو باشد شروع کن.
        
        متن باید کاملاً محاوره‌ای باشد، مثل اینکه واقعاً داری با طرف مقابل صحبت می‌کنی.
        از کلمات و اصطلاحات محاوره‌ای روزمره استفاده کن، مثل "میگم"، "خیلی خوشحالم"، "امیدوارم"، "انشالله" و غیره.
        از شکل‌های کوتاه‌شده کلمات مثل "می‌خوام" به جای "می‌خواهم" استفاده کن.
        
        پیام باید با ایموجی‌های متنوع و شاد نوروزی همراه باشد.
        پیام باید محترمانه اما کاملاً محاوره‌ای، گرم و صمیمی باشد.
        """
    
    # تولید و برگرداندن پاسخ
    return llm.predict(prompt)