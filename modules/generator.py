"""
ماژول تولید پیام‌های تبریک نوروزی
"""

def generate_greeting(llm, recipient_name, sender_name, topic=None, message_length='short'):
    """
    تولید پیام تبریک نوروزی محاوره‌ای و رسمی
    
    پارامترها:
    llm (ChatOpenAI): مدل زبانی
    recipient_name (str): نام گیرنده
    sender_name (str): نام فرستنده
    topic (str, optional): موضوع مورد علاقه گیرنده
    message_length (str): نوع پیام ('short' برای پیام کوتاه، 'long' برای پیام بلند)
    
    خروجی:
    str: پیام تبریک تولید شده
    """
    # پرامپت برای پیام کوتاه
    if message_length == 'short':
        if topic and topic.strip():
            prompt = f"""
            یک پیام تبریک نوروز ۱۴۰۴ کوتاه (حداکثر ۴ خط) و محاوره‌ای به زبان فارسی بنویس که از طرف {sender_name} به {recipient_name} فرستاده می‌شود.
            
            پیام باید شامل این موارد باشد:
            - کوتاه، حداکثر ۴ خط (خیلی مهم)
            - کاملاً محاوره‌ای با لحن صمیمی، مثل "می‌خوام" به جای "می‌خواهم"
            - اشاره به موضوع مورد علاقه گیرنده که "{topic}" است
            - حداکثر ۳ ایموجی مرتبط با نوروز
            - بدون استفاده از کلیشه‌های تکراری عید
            - حتماً در انتهای پیام، اسم فرستنده ({sender_name}) را بیاور
            
            از توضیحات اضافی و متن‌های طولانی خودداری کن.
            """
        else:
            prompt = f"""
            یک پیام تبریک نوروز ۱۴۰۴ کوتاه (حداکثر ۴ خط) و محاوره‌ای به زبان فارسی بنویس که از طرف {sender_name} به {recipient_name} فرستاده می‌شود.
            
            پیام باید شامل این موارد باشد:
            - کوتاه، حداکثر ۴ خط (خیلی مهم)
            - کاملاً محاوره‌ای با لحن صمیمی، مثل "می‌خوام" به جای "می‌خواهم"
            - حداکثر ۳ ایموجی مرتبط با نوروز
            - بدون استفاده از کلیشه‌های تکراری عید
            - حتماً در انتهای پیام، اسم فرستنده ({sender_name}) را بیاور
            
            از توضیحات اضافی و متن‌های طولانی خودداری کن.
            """
    # پرامپت برای پیام بلند
    else:
        if topic and topic.strip():
            prompt = f"""
            یک پیام تبریک نوروز ۱۴۰۴ مفصل (۶ تا ۸ خط) و محاوره‌ای به زبان فارسی بنویس که از طرف {sender_name} به {recipient_name} فرستاده می‌شود.
            
            پیام باید شامل این موارد باشد:
            - کاملاً محاوره‌ای با لحن صمیمی و گرم
            - یک بیت شعر مرتبط با نوروز یا بهار در ابتدای پیام (ترجیحاً از حافظ، سعدی یا مولانا)
            - اشاره به موضوع مورد علاقه گیرنده که "{topic}" است
            - آرزوهای خوب برای سال جدید
            - ۴ تا ۵ ایموجی مرتبط با نوروز و بهار
            - حتماً در انتهای پیام، اسم فرستنده ({sender_name}) را بیاور
            """
        else:
            prompt = f"""
            یک پیام تبریک نوروز ۱۴۰۴ مفصل (۶ تا ۸ خط) و محاوره‌ای به زبان فارسی بنویس که از طرف {sender_name} به {recipient_name} فرستاده می‌شود.
            
            پیام باید شامل این موارد باشد:
            - کاملاً محاوره‌ای با لحن صمیمی و گرم
            - یک بیت شعر مرتبط با نوروز یا بهار در ابتدای پیام (ترجیحاً از حافظ، سعدی یا مولانا)
            - آرزوهای خوب برای سال جدید
            - ۴ تا ۵ ایموجی مرتبط با نوروز و بهار
            - حتماً در انتهای پیام، اسم فرستنده ({sender_name}) را بیاور
            """
    
    # تولید و برگرداندن پاسخ
    return llm.predict(prompt)