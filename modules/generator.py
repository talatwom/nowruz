"""
ماژول تولید پیام‌های تبریک نوروزی
"""

def generate_greeting(llm, recipient_name, sender_name, topic=None):
    """
    تولید پیام تبریک نوروزی محاوره‌ای و رسمی
    
    پارامترها:
    llm (ChatOpenAI): مدل زبانی
    recipient_name (str): نام گیرنده
    sender_name (str): نام فرستنده
    topic (str, optional): موضوع مورد علاقه گیرنده
    
    خروجی:
    str: پیام تبریک تولید شده
    """
    if topic and topic.strip():
        prompt = f"""
        یک پیام تبریک نوروز ۱۴۰۴ کوتاه (حداکثر ۴ خط) و محاوره‌ای به زبان فارسی بنویس که از طرف {sender_name} به {recipient_name} فرستاده می‌شود.
        
        پیام باید شامل این موارد باشد:
        - کوتاه، حداکثر ۴ خط (خیلی مهم)
        - کاملاً محاوره‌ای با لحن صمیمی، مثل "می‌خوام" به جای "می‌خواهم"
        - اشاره به موضوع مورد علاقه گیرنده که "{topic}" است
        - حداکثر ۳ ایموجی مرتبط با نوروز
        - بدون استفاده از کلیشه‌های تکراری عید
        
        از توضیحات اضافی و متن‌های طولانی خودداری کن.
        """
    else:
        prompt = f"""
        یک پیام تبریک نوروز ۱۴۰۴ کوتاه (حداکثر ۴ خط) و محاوره‌ای به زبان فارسی بنویس که از طرف {sender_name} به {recipient_name} فرستاده می‌شود.
        
        پیام باید شامل این موارد باشد:
        - کوتاه، حداکثر ۴ خط (خیلی مهم)
        - کاملاً محاوره‌ای با لحن صمیمی، مثل "می‌خوام" به جای "می‌خواهم"
        - حداکثر ۳ ایموجی مرتبط با نوروز
        - بدون استفاده از کلیشه‌های تکراری عید
        
        از توضیحات اضافی و متن‌های طولانی خودداری کن.
        """
    
    # تولید و برگرداندن پاسخ
    return llm.predict(prompt)